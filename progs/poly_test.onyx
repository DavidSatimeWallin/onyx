package main

#include_folder "./core"

#include_file "builtin"
#include_file "wasi"
#include_file "alloc"
#include_file "intrinsics"
#include_file "random"
#include_file "string"
#include_file "file"

use package builtin

// NOTE: Didn't realize this would work so easily
use package core { string_builder_append as sba }
use package core

use package memory
use package wasi
use package intrinsics
use package random
use package file
use package stdio

print_arr_details :: proc (arr: ^[..] $T) {
    print("\nArray details:\n\tSize: ");
    print(arr.count);
    print("\n\tCapacity: ");
    print(arr.capacity);
    print("\n\tData ptr: ");
    print(cast(u32) arr.data, 16);
    print("\n\n");
}

print_arr :: proc (arr: ^[..] $T) {
    for i: 0, arr.count {
        print(arr.data[i]);
        print(" ");
    }

    print("\n");
}

main :: proc (args: [] cstring) {
    iarr : [..] i32;
    array_init(^iarr, 24);
    defer array_free(^iarr);

    print_arr_details(^iarr);

    array_add(^iarr, 1234);

    for i: 0, 12 do array_add(^iarr, i % 5);

    print_arr_details(^iarr);
    print_arr(^iarr);

    array_remove_at(^iarr, 4);

    print_arr_details(^iarr);
    print_arr(^iarr);

    array_remove(^iarr, 1);
    array_remove(^iarr, 4);

    print_arr_details(^iarr);
    print_arr(^iarr);

    array_add_at(^iarr, 5678, 2);

    print_arr_details(^iarr);
    print_arr(^iarr);



    barr : [..] i64;
    array_init(^barr, 10);
    defer array_free(^barr);

    for i: 0, 1000 {
        array_add(^barr, cast(u64) (3 * i * i + 4 * i - 2));
    }

    print_arr_details(^barr);
    print_arr(^barr);

    print("Does the array contain 2638? ");
    print(array_contains(^barr, 2638l));
    print("\n");
}